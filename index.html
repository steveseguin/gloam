<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gloam! - Live Shopping Discovery</title>
	<link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAt1BMVEVMaXG5eNC9dsbbZ4bJb6ztXV7yW1PfZX+ghvbLb6iKkv9xof+8ebDhY3iwfOS/dcSmgfl7m/+Yiv+Lkv+ogPShhPzNbqRopv+3edX5V0P4V0X8Vj7ZZ4rRa5ungfd7mv9opv/9VTvVaZK/dcPFcrWqgOfxW1bXaI76V0PSa5jPbaG3edWFlf+pgPOwfeSsfuyze97nYGvgZHvzWlCbiP/tXV2Rjv90n/96m/+kg/1to//Dc7nbZ4X85c2aAAAAJ3RSTlMAYPyf/WCZICBjn78Qqr97n49gYI+vn2ifeL+/j7+fgO/vv7+/YLop9DGbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAYtJREFUeNpt0+l2gjAQBeBxYd9EEcWl1uUcFWjrgoDL+z9XZxKEhJZfwndNbgIBALCj+XymaiBc2mKzXBo2v1HWB7quauOL/f4Yx/2+wfzA/dokepU/nx0cf/32201te7drQ0Q8i1T029lpPPR26IkHc3KaCf18djTNYU6zb7tJ4rJAxLqgXy6vV+3gJcnJhVndX2k5TJPTtwsq9VN4QvYO+k8AGuvPExrrF2qNf+kAvL8CrYt7QD9V1l/5zwf8RmX9pXehiw7gUP+eGJhKjgnqLwbIx+LbpfWJAfS7LgVwfWIAXQrQ/ksB9EyYgvbnGIqBwT3LMlPyWF4mep6bohvyRg3R89R8f39/HBPoaerjAgTX+f7w+iP0tNRxgNr5/mP/4TtRlj5s0EPZsyphlmVhwfIY972W5/mInqzKggL4fe9qH+v6mPWnhFUUDwsM+v633pT5BxuZ9TdX5I8J2Ox8JI1jgvUvyT/xeBptZwnuOADNXnnQ7JJf/X/Cb23Pdd1Al96Fb1nWhI7/L7xtUk8YfKluAAAAAElFTkSuQmCC" />
    <style>
        :root {
            --primary: #6B46C1;
            --primary-dark: #553C9A;
            --primary-light: #805AD5;
            --accent: #ED64A6;
            --accent-dark: #D53F8C;
            --success: #38A169;
            --warning: #F6AD55;
            --danger: #EF4444;
            --background: #F7FAFC;
            --surface: #FFFFFF;
            --text: #1A202C;
            --text-muted: #718096;
            --border: #E2E8F0;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            --gradient-hover: linear-gradient(135deg, var(--primary-dark) 0%, var(--accent-dark) 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
        }
		
		.creator-avatar-large {
			width: 80px;
			height: 80px;
			border-radius: 50%;
			margin: 0 auto;
			background: var(--gradient-primary);
			color: white;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 24px;
			font-weight: 700;
			/* Add these properties for background image */
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
		}

        .header {
            background: var(--surface);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 72px;
        }

        .logo-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

 .stream-status {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 6px;
}

.status-live {
    background: var(--danger);
    color: white;
    animation: pulse 2s infinite;
}

        .logo-text {
            font-size: 24px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .search-container {
            position: relative;
            width: 100%;
            max-width: 480px;
        }

        .search-input {
            width: 100%;
            padding: 12px 48px 12px 20px;
            border: 1px solid var(--border);
            border-radius: 50px;
            font-size: 15px;
            transition: all 0.2s ease;
            background: var(--background);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(107, 70, 193, 0.1);
            background: var(--surface);
        }

        .search-button {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gradient-primary);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            transition: all 0.2s ease;
        }

        .search-button:hover {
            background: var(--gradient-hover);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .region-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--background);
            border-radius: 50px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .region-badge:hover {
            background: var(--border);
        }

        .go-live-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .go-live-btn:hover {
            background: var(--gradient-hover);
            transform: translateY(-1px);
        }

.main-content {
    max-width: 1440px;
    margin: 0 auto;
    padding: 0 24px;
    /* Add subtle content fade-in */
    animation: fadeIn 0.5s ease-out;
}

        .niche-nav {
            display: flex;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            scrollbar-width: none;
        }

        .niche-nav::-webkit-scrollbar {
            display: none;
        }

        .niche-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 50px;
            background: transparent;
            color: var(--text-muted);
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .niche-btn.active {
            background: var(--gradient-primary);
            color: white;
        }

        .niche-btn:hover:not(.active) {
            background: var(--background);
            color: var(--text);
        }

.hero-banner {
    margin: 32px 0;
    border-radius: 24px;
    overflow: hidden;
    position: relative;
    min-height: 400px;
    background: var(--gradient-primary);
    display: flex;
    align-items: center;
    /* Add subtle animation */
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

        .hero-content {
            position: relative;
            z-index: 2;
            padding: 60px;
            max-width: 600px;
            color: white;
        }

        .hero-title {
            font-size: 48px;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 16px;
        }

        .hero-subtitle {
            font-size: 20px;
            opacity: 0.9;
            margin-bottom: 32px;
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(3, auto);
            gap: 32px;
            margin-bottom: 32px;
            justify-content: start;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            display: block;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
            display: block;
            margin-top: 4px;
        }

        .hero-ctas {
            display: flex;
            gap: 16px;
        }

        .cta-primary {
            background: white;
            color: var(--primary);
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .cta-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .cta-secondary {
            background: transparent;
            border: 2px solid white;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .cta-secondary:hover {
            background: rgba(255,255,255,0.1);
        }

        .hero-visual {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 50%;
            background-image: url('/api/placeholder/800/400');
            background-size: cover;
            background-position: center;
            opacity: 0.15;
        }

        .section {
            margin: 48px 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
        }

        .view-all-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: gap 0.2s ease;
        }

        .view-all-link:hover {
            gap: 8px;
        }

        .stream-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
        }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.stream-card {
    background: var(--surface);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: var(--shadow-md);
    transition: all 0.3s ease;
    cursor: pointer;
    /* Add subtle gradient border */
    border: 1px solid transparent;
    background-clip: padding-box;
}

.stream-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    /* Subtle gradient border on hover */
    border: 1px solid rgba(107, 70, 193, 0.2);
}

        .stream-thumbnail {
            position: relative;
            aspect-ratio: 16/9;
            overflow: hidden;
        }

        .stream-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .stream-card:hover .stream-thumbnail img {
            transform: scale(1.05);
        }

.live-indicator {
    position: absolute;
    top: 12px;
    left: 12px;
    background: var(--danger);
    color: white;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 6px;
    animation: pulse 2s infinite;
    /* Add subtle glow */
    box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
}

        .live-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }

        .promotion-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
        }

        .viewer-count {
            position: absolute;
            bottom: 12px;
            left: 12px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            backdrop-filter: blur(4px);
        }

        .products-preview {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px 12px 12px;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .stream-card:hover .products-preview {
            transform: translateY(0);
        }

        .product-thumbnails {
            display: flex;
            gap: 8px;
        }

        .product-thumb {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            overflow: hidden;
        }

        .product-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .stream-details {
            padding: 16px;
        }

        .stream-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .creator-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .creator-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .creator-name {
            font-weight: 500;
        }

        .stream-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-tag {
            background: var(--background);
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
        }

        .store-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .creator-spotlight {
            background: var(--surface);
            border-radius: 24px;
            padding: 48px;
            margin: 64px 0;
            box-shadow: var(--shadow-md);
        }

        .creator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }

        .creator-card {
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .creator-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .creator-card-header {
            position: relative;
            margin-bottom: 20px;
        }

        .creator-verified {
            position: absolute;
            bottom: 0;
            right: calc(50% - 40px);
            width: 24px;
            height: 24px;
            background: var(--primary);
            border-radius: 50%;
            border: 3px solid var(--surface);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .creator-name-large {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .creator-category {
            color: var(--text-muted);
            font-size: 14px;
            margin-bottom: 16px;
        }

        .creator-stats {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 20px;
        }

        .creator-stat {
            text-align: center;
        }

        .creator-stat-value {
            font-weight: 600;
            display: block;
        }

        .creator-stat-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .follow-button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: var(--gradient-primary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0;
            transform: translateY(10px);
        }

        .creator-card:hover .follow-button {
            opacity: 1;
            transform: translateY(0);
        }

        .follow-button:hover {
            background: var(--gradient-hover);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        @media (max-width: 768px) {
            .nav-container {
                padding: 0 16px;
            }

            .search-container {
                display: none;
            }

            .hero-content {
                padding: 40px 24px;
            }

            .hero-title {
                font-size: 32px;
            }

            .hero-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 16px;
            }

            .stat-value {
                font-size: 28px;
            }

            .creator-grid {
                grid-template-columns: 1fr;
            }

            .creator-spotlight {
                padding: 24px;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 28px;
            }

            .hero-subtitle {
                font-size: 16px;
            }

            .hero-stats {
                gap: 12px;
            }

            .stat-value {
                font-size: 24px;
            }

            .hero-ctas {
                flex-direction: column;
            }

            .cta-primary, .cta-secondary {
                width: 100%;
                text-align: center;
            }
        }
		
		<!-- Add this new CSS section after line 134 -->
.canadian-badge {
    position: absolute;
    top: 12px;
    left: 72px; /* Positioned next to LIVE badge */
    background: #FF0000;
    color: white;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 6px;
}

.canadian-badge::before {
    content: '🍁';
}
.free-shipping-banner {
    background: linear-gradient(135deg, #D64045 0%, #B03236 100%);
    color: white;
    padding: 12px 24px;
    margin: 24px 0;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    font-weight: 600;
    text-align: center;
}

.free-shipping-banner::before {
    content: '🍁';
    font-size: 20px;
}

.canadian-badge {
    position: absolute;
    top: 12px;
    left: 72px; /* Positioned next to LIVE badge */
    background: #D64045;
    color: white;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 6px;
}

.canadian-badge::before {
    content: '🍁';
}

.canadian-creator-tag {
    position: absolute;
    bottom: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: #D64045;
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 4px;
}

.canadian-creator-tag::before {
    content: '🍁';
    font-size: 10px;
}

.canadian-product-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    background: rgba(214, 64, 69, 0.9);
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
    </style>
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo-wrapper">
                <img style="height:40px;" src="logo.png" />
            </div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search beauty trends, fashion brands, or creator shows...">
                <button class="search-button">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="M21 21l-4.35-4.35"></path>
                    </svg>
                </button>
            </div>
            <div class="nav-actions">
                <div class="region-badge">
                    <span>🌎</span>
                    <span>Global</span>
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </div>
                <button class="go-live-btn" onclick="window.open('https://stageten.tv/creators');">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M23 7l-7 5 7 5V7z"></path>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                    Become a Creator
                </button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <nav class="niche-nav">
            <button class="niche-btn active" data-niche="all">For You</button>
            <button class="niche-btn" data-niche="fashion">Fashion</button>
            <button class="niche-btn" data-niche="beauty">Beauty</button>
            <button class="niche-btn" data-niche="fashion">Luxury</button>
            <button class="niche-btn" data-niche="beauty">Skincare</button>
            <button class="niche-btn" data-niche="fashion">Street Style</button>
            <button class="niche-btn" data-niche="beauty">Makeup</button>
        </nav>

        <div class="hero-banner">
            <div class="hero-content">
                <h1 class="hero-title">The Future of Fashion & Beauty Shopping is Live</h1>
                <p class="hero-subtitle">Shop directly from fashion and beauty creators you trust — in real-time, with exclusive offers</p>
                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-value">50+</span>
                        <span class="stat-label">Active Creators</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">$30K+</span>
                        <span class="stat-label">Monthly GMV</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">40%</span>
                        <span class="stat-label">Conversion Rate</span>
                    </div>
                </div>
                <div class="hero-ctas">
                    <a href="#" class="cta-primary">Start Shopping Live</a>
                    <a href="#" class="cta-secondary" onclick="window.open('https://stageten.tv/creators');">Apply as Creator</a>
                </div>
            </div>
            <div class="hero-visual"></div>
        </div>

		<div class="free-shipping-banner">
			<span>BUY CANADIAN-MADE, GET FREE SHIPPING!</span>
			<span style="font-weight: 400;">StageTEN covers shipping for all locally made products</span>
		</div>

        <section class="section">
            <div class="section-header">
                <h2 class="section-title">Live Now — Fashion & Beauty Exclusives</h2>
                <a href="#" class="view-all-link">View All <span>→</span></a>
            </div>
            <div class="stream-grid">
                <div class="stream-card" data-niche="beauty">
					<div class="stream-thumbnail">
						<img src="cover4.png" alt="Live stream">
						<div class="live-indicator">
							<span class="live-dot"></span>
							LIVE
						</div>
						<div class="canadian-badge">Canadian Made</div>
						<div class="promotion-badge">40% OFF</div>
						<div class="viewer-count">
							<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
								<circle cx="12" cy="12" r="3"></circle>
							</svg>
							2.4K watching
						</div>
						<div class="products-preview">
							<div class="product-thumbnails">
								<div class="product-thumb">
									<img src="product2.png" alt="Product">
									<div class="canadian-product-badge">🍁</div>
								</div>
								<div class="product-thumb">
									<img src="product1.png" alt="Product">
								</div>
								<div class="product-thumb">
									<img src="cover2.png" alt="Product">
									<div class="canadian-product-badge">🍁</div>
								</div>
							</div>
						</div>
					</div>
					<div class="stream-details">
						<h3 class="stream-title">Korean Skincare Routine - Glass Skin Tutorial</h3>
						<div class="creator-info">
							<div class="creator-avatar">SK</div>
							<span class="creator-name">Sarah Kim - Toronto</span>
						</div>
						<div class="stream-footer">
							<span class="category-tag">Beauty</span>
							<a href="#" class="store-link">Visit Store →</a>
						</div>
					</div>
				</div>

                <div class="stream-card" data-niche="fashion">
                    <div class="stream-thumbnail">
                        <img src="cover3.png" alt="Live stream">
                        <div class="live-indicator">
                            <span class="live-dot"></span>
                            LIVE
                        </div>
                        <div class="promotion-badge">BOGO</div>
                        <div class="viewer-count">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            1.8K watching
                        </div>
                        <div class="products-preview">
                            <div class="product-thumbnails">
                                <div class="product-thumb">
                                    <img src="product2.png" alt="Product">
                                </div>
                                <div class="product-thumb">
                                    <img src="product1.png" alt="Product">
                                </div>
                                <div class="product-thumb">
                                    <img src="cover3.png" alt="Product">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stream-details">
                        <h3 class="stream-title">Summer Fashion Haul - Sustainable Brands You'll Love</h3>
                        <div class="creator-info">
                            <div class="creator-avatar">EC</div>
                            <span class="creator-name">Emma Chen</span>
                        </div>
                        <div class="stream-footer">
                            <span class="category-tag">Fashion</span>
                            <a href="#" class="store-link">Visit Store →</a>
                        </div>
                    </div>
                </div>

                <div class="stream-card" data-niche="wellness">
                    <div class="stream-thumbnail">
                        <img src="cover2.png" alt="Live stream">
                        <div class="live-indicator">
                            <span class="live-dot"></span>
                            LIVE
                        </div>
                        <div class="promotion-badge">Free Shipping</div>
                        <div class="viewer-count">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            956 watching
                        </div>
                        <div class="products-preview">
                            <div class="product-thumbnails">
                                <div class="product-thumb">
                                    <img src="product1.png" alt="Product">
                                </div>
                                <div class="product-thumb">
                                    <img src="product2.png" alt="Product">
                                </div>
                                <div class="product-thumb">
                                    <img src="product1.png" alt="Product">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stream-details">
                        <h3 class="stream-title">Wellness Wednesday: Morning Routine Essentials</h3>
                        <div class="creator-info">
                            <div class="creator-avatar">ML</div>
                            <span class="creator-name">Maya Lopez</span>
                        </div>
                        <div class="stream-footer">
                            <span class="category-tag">Wellness</span>
                            <a href="#" class="store-link">Visit Store →</a>
                        </div>
                    </div>
                </div>
				
				<div class="stream-card" data-niche="wellness">
                    <div class="stream-thumbnail">
                        <img src="cover2.png" alt="Live stream">
                        <div class="live-indicator">
                            <span class="live-dot"></span>
                            LIVE
                        </div>
                        <div class="promotion-badge">Free Shipping</div>
                        <div class="viewer-count">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            956 watching
                        </div>
                        <div class="products-preview">
                            <div class="product-thumbnails">
                                <div class="product-thumb">
                                    <img src="product1.png" alt="Product">
                                </div>
                                <div class="product-thumb">
                                    <img src="product2.png" alt="Product">
                                </div>
                                <div class="product-thumb">
                                    <img src="product1.png" alt="Product">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stream-details">
                        <h3 class="stream-title">Wellness Wednesday: Morning Routine Essentials</h3>
                        <div class="creator-info">
                            <div class="creator-avatar">ML</div>
                            <span class="creator-name">Maya Lopez</span>
                        </div>
                        <div class="stream-footer">
                            <span class="category-tag">Wellness</span>
                            <a href="#" class="store-link">Visit Store →</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="creator-spotlight">
            <div class="section-header">
                <h2 class="section-title">Top Fashion & Beauty Creators</h2>
                <a href="#" class="view-all-link">Explore All <span>→</span></a>
            </div>
            <div class="creator-grid">
                <div class="creator-card">
					<div class="creator-card-header" style="position: relative;">
						<div class="creator-avatar-large" style="background-image:url('user1.jpg');"></div>
						<div class="creator-verified">✓</div>
						<div class="canadian-creator-tag">Canadian Creator</div>
					</div>
					<h3 class="creator-name-large">Alex Jordan</h3>
					<p class="creator-category">Fashion Influencer - Vancouver</p>
					<div class="creator-stats">
						<div class="creator-stat">
							<span class="creator-stat-value">524K</span>
							<span class="creator-stat-label">Followers</span>
						</div>
						<div class="creator-stat">
							<span class="creator-stat-value">142</span>
							<span class="creator-stat-label">Live Shows</span>
						</div>
					</div>
					<button class="follow-button">Follow</button>
				</div>

                <div class="creator-card">
					<div class="creator-card-header" style="position: relative;">
						<div class="creator-avatar-large">RB</div>
						<div class="creator-verified">✓</div>
						<div class="canadian-creator-tag">Canadian Creator</div>
					</div>
					<h3 class="creator-name-large">Rachel Brooks</h3>
					<p class="creator-category">Beauty Expert - Montreal</p>
					<div class="creator-stats">
						<div class="creator-stat">
							<span class="creator-stat-value">367K</span>
							<span class="creator-stat-label">Followers</span>
						</div>
						<div class="creator-stat">
							<span class="creator-stat-value">89</span>
							<span class="creator-stat-label">Live Shows</span>
						</div>
					</div>
					<button class="follow-button">Follow</button>
				</div>

                <div class="creator-card">
                    <div class="creator-card-header">
                        <div class="creator-avatar-large" style="background-image:url('user2.jpg');"></div>
                        <div class="creator-verified">✓</div>
                    </div>
                    <h3 class="creator-name-large">David Wong</h3>
                    <p class="creator-category">Fitness Coach</p>
                    <div class="creator-stats">
                        <div class="creator-stat">
                            <span class="creator-stat-value">289K</span>
                            <span class="creator-stat-label">Followers</span>
                        </div>
                        <div class="creator-stat">
                            <span class="creator-stat-value">67</span>
                            <span class="creator-stat-label">Live Shows</span>
                        </div>
                    </div>
                    <button class="follow-button">Follow</button>
                </div>

                <div class="creator-card">
                    <div class="creator-card-header">
						<div class="creator-avatar-large" style="background-image:url('user3.jpg');"></div>
                        <div class="creator-verified">✓</div>
                    </div>
                    <h3 class="creator-name-large">Sofia Patel</h3>
                    <p class="creator-category">Wellness Guide</p>
                    <div class="creator-stats">
                        <div class="creator-stat">
                            <span class="creator-stat-value">198K</span>
                            <span class="creator-stat-label">Followers</span>
                        </div>
                        <div class="creator-stat">
                            <span class="creator-stat-value">45</span>
                            <span class="creator-stat-label">Live Shows</span>
                        </div>
                    </div>
                    <button class="follow-button">Follow</button>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="section-header">
                <h2 class="section-title">Starting Soon</h2>
                <a href="#" class="view-all-link">View Schedule <span>→</span></a>
            </div>
            <div class="stream-grid">
                <div class="stream-card" data-niche="fashion">
					<div class="stream-thumbnail">
						<img src="cover1.png" alt="Upcoming stream">
						<div class="canadian-badge">Canadian Made</div>
						<div class="promotion-badge">Starts in 30m</div>
						<div class="products-preview">
							<div class="product-thumbnails">
								<div class="product-thumb">
									<img src="product1.png" alt="Product">
									<div class="canadian-product-badge">🍁</div>
								</div>
								<div class="product-thumb">
									<img src="product2.png" alt="Product">
								</div>
								<div class="product-thumb">
									<img src="product1.png" alt="Product">
									<div class="canadian-product-badge">🍁</div>
								</div>
							</div>
						</div>
					</div>
					<div class="stream-details">
						<h3 class="stream-title">Capsule Wardrobe Building: 10 Essential Pieces</h3>
						<div class="creator-info">
							<div class="creator-avatar">LM</div>
							<span class="creator-name">Lisa Martinez - Calgary</span>
						</div>
						<div class="stream-footer">
							<span class="category-tag">Fashion</span>
							<a href="#" class="store-link">Set Reminder →</a>
						</div>
					</div>
				</div>

                <div class="stream-card" data-niche="beauty">
                    <div class="stream-thumbnail">
                        <img src="cover1.png" alt="Upcoming stream">
                        <div class="promotion-badge">Tomorrow 8PM</div>
                        <div class="products-preview">
                            <div class="product-thumbnails">
                                <div class="product-thumb">
                                    <img src="product1.png" alt="Product">
                                </div>
                                <div class="product-thumb">
                                    <img src="product2.png" alt="Product">
                                </div>
                                <div class="product-thumb">
                                    <img src="product1.png" alt="Product">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stream-details">
                        <h3 class="stream-title">Clean Beauty Masterclass: Non-Toxic Must-Haves</h3>
                        <div class="creator-info">
                            <div class="creator-avatar">JT</div>
                            <span class="creator-name">Jamie Taylor</span>
                        </div>
                        <div class="stream-footer">
                            <span class="category-tag">Beauty</span>
                            <a href="#" class="store-link">Set Reminder →</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="creator-benefits" style="background: var(--gradient-primary); color: white; padding: 64px 24px; border-radius: 24px; margin: 64px 0; text-align: center;">
            <h2 style="font-size: 36px; margin-bottom: 16px;">Become a Stage TEN Creator</h2>
            <p style="font-size: 20px; opacity: 0.9; margin-bottom: 48px;">Join the next generation of live shopping pioneers</p>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 32px; max-width: 1200px; margin: 0 auto;">
                <div style="background: rgba(255,255,255,0.1); padding: 24px; border-radius: 16px;">
                    <h3 style="font-size: 48px; margin-bottom: 8px;">$500</h3>
                    <p style="font-size: 18px; margin-bottom: 8px;">Guaranteed First Show</p>
                    <p style="font-size: 14px; opacity: 0.8;">Plus commissions on sales</p>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 24px; border-radius: 16px;">
                    <h3 style="font-size: 48px; margin-bottom: 8px;">90%</h3>
                    <p style="font-size: 18px; margin-bottom: 8px;">Revenue Share</p>
                    <p style="font-size: 14px; opacity: 0.8;">Highest in the industry</p>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 24px; border-radius: 16px;">
                    <h3 style="font-size: 48px; margin-bottom: 8px;">24h</h3>
                    <p style="font-size: 18px; margin-bottom: 8px;">Fast Payouts</p>
                    <p style="font-size: 14px; opacity: 0.8;">Get paid next day</p>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 24px; border-radius: 16px;">
                    <h3 style="font-size: 48px; margin-bottom: 8px;">10K+</h3>
                    <p style="font-size: 18px; margin-bottom: 8px;">Active Shoppers</p>
                    <p style="font-size: 14px; opacity: 0.8;">Growing community</p>
                </div>
            </div>
            <button style="background: white; color: var(--primary); border: none; padding: 16px 32px; border-radius: 8px; font-size: 18px; font-weight: 600; margin-top: 48px; cursor: pointer;">Apply Now - Limited Spots</button>
        </section>
    </main>

    <footer style="background: var(--surface); border-top: 1px solid var(--border); padding: 48px 24px; margin-top: 64px;">
        <div style="max-width: 1440px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 32px;">
            <div>
                <h4 style="font-weight: 600; margin-bottom: 16px;">For Creators</h4>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--text-muted); text-decoration: none;">Apply to Host</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--text-muted); text-decoration: none;">Creator Resources</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--text-muted); text-decoration: none;">Success Stories</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-weight: 600; margin-bottom: 16px;">For Shoppers</h4>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--text-muted); text-decoration: none;">Live Shows</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--text-muted); text-decoration: none;">Fashion Picks</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--text-muted); text-decoration: none;">Beauty Exclusives</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-weight: 600; margin-bottom: 16px;">Company</h4>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--text-muted); text-decoration: none;">About Us</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--text-muted); text-decoration: none;">Careers</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" style="color: var(--text-muted); text-decoration: none;">Press</a></li>
                </ul>
            </div>
            <div>
                <h4 style="font-weight: 600; margin-bottom: 16px;">Connect</h4>
                <p style="color: var(--text-muted); margin-bottom: 16px;">Join the future of live shopping</p>
                <div style="display: flex; gap: 16px;">
                    <a href="#" style="color: var(--primary); text-decoration: none;">Instagram</a>
                    <a href="#" style="color: var(--primary); text-decoration: none;">TikTok</a>
                    <a href="#" style="color: var(--primary); text-decoration: none;">YouTube</a>
                </div>
            </div>
        </div>
		<div style="max-width: 1440px; margin: 32px auto 0; padding-top: 32px; border-top: 1px solid var(--border); text-align: center; color: var(--text-muted); font-size: 14px;">
			© 2025 Stage TEN. Canada's first global live shopping network. 🍁 Proudly Canadian.
		</div>
    </footer>
<script>
async function fetchStreamData() {
    try {
        // Use our new Cloudflare worker endpoint that provides enhanced data
        const response = await fetch('https://young-grass-8d02.vdo.workers.dev/');
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const data = await response.json();
        
        // Check if the API returns country information
        const countryData = data.find(item => item.country);
        
        // Store detected country in localStorage if available
        if (countryData && countryData.country && !localStorage.getItem('userDetectedCountry')) {
            localStorage.setItem('userDetectedCountry', countryData.country);
        }
        
        return data;
    } catch (error) {
        console.error('Error fetching data:', error);
        return null;
    }
}
// Fallback data based on your example
function getFallbackData() {
    try {
        const fileContent = localStorage.getItem('stageTenFallbackData');
        if (fileContent) {
            return JSON.parse(fileContent);
        }
    } catch (error) {
        console.error('Error parsing local fallback data:', error);
    }
    
    // If there's no localStorage data, return the hardcoded fallback
    return [
        {
            "_metadata": {
                "jsRuntime": "node",
                "nodeVersion": "v20.18.3"
            },
            "channel": "server",
            "context": {
                "library": {
                    "name": "@segment/analytics-node",
                    "version": "2.0.0"
                }
            },
            "event": "tv.stageten.plugin-commerce.output.live",
            "integrations": {},
            "messageId": "node-next-1745615189110-5f164163-52ad-4058-b2c2-c1fb30098505",
            "originalTimestamp": "2025-04-25T21:06:29.109Z",
            "projectId": "ieWx4BBfzZwJS1mS4b88cz",
            "properties": {
                "affiliateCommunityMemberId": null,
                "affiliateEmail": null,
                "affiliateUsername": null,
                "email": "parkermaisondatelier@gmail.com",
                "isShopOwner": true,
                "shopAppUrl": "https://shop.app/mini/stageten?shop_id=72737784054",
                "shopDomain": "dsqg0k-yw.myshopify.com",
                "shopName": "Parker Maison D'Atelier",
                "shopUrl": "https://parkermaison.com",
                "watchUrl": "https://play.stageten.tv/channel/4ba6b8f4-13dc-453e-bc7e-de8600c97595"
            },
            "timestamp": "2025-04-25T21:06:29.345Z",
            "type": "track",
            "userId": "dsqg0k-yw.myshopify.com"
        },
        {
            "event": "tv.stageten.plugin-commerce.output.live",
            "messageId": "node-next-1745615189120-5f164163-52ad-4058-b2c2-c1fb30098506",
            "originalTimestamp": "2025-04-25T19:06:29.109Z",
            "properties": {
                "email": "canadiancreative@gmail.com",
                "shopDomain": "canadian-style.myshopify.com",
                "shopName": "Canadian Creative Collections",
                "shopUrl": "https://canadiancreative.com",
                "watchUrl": "https://play.stageten.tv/channel/5ca7b9f5-24dc-463e-ac7e-ef7600d97596"
            },
            "timestamp": "2025-04-25T19:06:29.345Z"
        },
        {
            "event": "tv.stageten.plugin-commerce.output.live",
            "messageId": "node-next-1745615189130-5f164163-52ad-4058-b2c2-c1fb30098507",
            "originalTimestamp": "2025-04-25T20:36:29.109Z",
            "properties": {
                "email": "fashionforward@gmail.com",
                "shopDomain": "fashion-forward.myshopify.com",
                "shopName": "Fashion Forward Studio",
                "shopUrl": "https://fashionforwardstudio.com",
                "watchUrl": "https://play.stageten.tv/channel/6da8b9f6-35dc-473e-bd7e-fg8700e97597"
            },
            "timestamp": "2025-04-25T20:36:29.345Z"
        },
        {
            "event": "tv.stageten.plugin-commerce.output.live",
            "messageId": "node-next-1745615189140-5f164163-52ad-4058-b2c2-c1fb30098508",
            "originalTimestamp": "2025-04-25T22:16:29.109Z",
            "properties": {
                "email": "beautyessentials@gmail.com",
                "shopDomain": "beauty-essentials.myshopify.com",
                "shopName": "Beauty Essentials",
                "shopUrl": "https://beautyessentials.com",
                "watchUrl": "https://play.stageten.tv/channel/7ea9b9f7-46dc-483e-ce7e-gh9800f97598"
            },
            "timestamp": "2025-04-25T22:16:29.345Z"
        }
    ];
}
// Process stream data
function processStreamData(data) {
    if (!Array.isArray(data)) {
        console.error('Data is not an array');
        return [];
    }
    const streams = data.filter(item => 
        (item.event === 'tv.stageten.plugin-commerce.output.live' && 
        item.properties && 
        item.properties.watchUrl) || 
        (item.shopName && item.watchUrl) // Support for direct data format
    );
    const currentTime = Date.now();
    const fourHoursInMs = 4 * 60 * 60 * 1000;
    const twentyFourHoursInMs = 24 * 60 * 60 * 1000;
    return streams.map(stream => {
        // Handle both data formats
        const properties = stream.properties || stream;
        
        // Ensure we have a proper timestamp
        let timestamp;
        if (typeof stream.timestamp === 'number') {
            timestamp = stream.timestamp;
        } else if (stream.timestamp) {
            timestamp = new Date(stream.timestamp).getTime();
        } else if (stream.originalTimestamp) {
            timestamp = new Date(stream.originalTimestamp).getTime();
        } else {
            timestamp = currentTime - Math.floor(Math.random() * fourHoursInMs); // Fallback
        }
        
        // Calculate stream status - FIXED
        const timeDiff = currentTime - timestamp;
        let streamStatus;
        
        // First check explicit isLive flag from the data
        if (stream.isLive === true || (stream.channelData && stream.channelData.isLive === true)) {
            streamStatus = 'live';
        } 
        // If not explicitly live, calculate based on time
        else if (stream.isLive === false || (stream.channelData && stream.channelData.isLive === false)) {
            if (timeDiff > 0) {
                streamStatus = 'ended';
            } else {
                streamStatus = 'upcoming';
            }
        }
        // No explicit flag, use time-based logic
        else {
            if (timeDiff > fourHoursInMs) {
                streamStatus = 'ended';
            } else if (timeDiff < 0) {
                streamStatus = 'upcoming';
            } else {
                streamStatus = 'live'; // Default to live if within the last 4 hours
            }
        }
        
        // If outside 24 hour window, filter out
        if (Math.abs(timeDiff) > twentyFourHoursInMs) {
            streamStatus = 'ended';
        }
        
        return {
            shopName: properties.shopName || stream.shopName || "Stage TEN Shop",
            shopDomain: properties.shopDomain || stream.shopDomain || "",
            shopUrl: properties.shopUrl || stream.shopUrl || "",
            watchUrl: properties.watchUrl || stream.watchUrl || "",
            timestamp: timestamp,
            streamStatus: streamStatus,
            timeAgo: formatTimeAgo(timestamp),
            startTime: formatStartTime(timestamp),
            email: properties.email || stream.email || "",
            channelId: stream.channelId || (properties.watchUrl ? properties.watchUrl.split('/').pop() : null),
            isCanadian: (properties.shopDomain || stream.shopDomain || "").includes('.ca') ||
                       (properties.shopName || stream.shopName || "").toLowerCase().includes('canadian') ||
                       (properties.email || stream.email || "").toLowerCase().includes('.ca'),
            // Copy existing enhanced data if available
            title: stream.title || properties.title,
            description: stream.description || properties.description,
            thumbnailUrl: stream.thumbnailUrl,
            avatarUrl: stream.avatarUrl,
            displayName: stream.displayName,
            channelData: stream.channelData,
            products: stream.products || []
        };
    })
    .filter(stream => stream.streamStatus !== 'filtered')
    .sort((a, b) => {
        // First sort by status (live > upcoming > ended)
        const statusOrder = { live: 0, upcoming: 1, ended: 2 };
        if (statusOrder[a.streamStatus] !== statusOrder[b.streamStatus]) {
            return statusOrder[a.streamStatus] - statusOrder[b.streamStatus];
        }
        
        // Then sort by age (newer first for live/upcoming, older first for ended)
        if (a.streamStatus === 'ended') {
            return b.timestamp - a.timestamp; // Older ended streams first
        } else {
            return b.timestamp - a.timestamp; // Newer live/upcoming streams first
        }
    });
}

function formatTimeAgo(timestamp) {
    const now = Date.now();
    const diffInSeconds = Math.floor((now - timestamp) / 1000);
    
    if (diffInSeconds < 0) {
        // Upcoming stream
        const absDiff = Math.abs(diffInSeconds);
        if (absDiff < 60) return 'Starting soon';
        if (absDiff < 3600) return `Starts in ${Math.floor(absDiff / 60)}m`;
        if (absDiff < 86400) return `Starts in ${Math.floor(absDiff / 3600)}h`;
        return `Starts on ${new Date(timestamp).toLocaleDateString()}`;
    }
    
    // Past stream
    if (diffInSeconds < 60) return 'Just now';
    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
    if (diffInSeconds < 14400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
    if (diffInSeconds < 86400) return 'Recent';
    return `${Math.floor(diffInSeconds / 86400)}d ago`;
}

// Format start time for display
function formatStartTime(timestamp) {
    const date = new Date(timestamp);
    const now = new Date();
    const isToday = date.getDate() === now.getDate() && 
                   date.getMonth() === now.getMonth() && 
                   date.getFullYear() === now.getFullYear();
    
    let formattedTime = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    if (isToday) {
        return `Today at ${formattedTime}`;
    } else {
        // Get day name
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const dayName = days[date.getDay()];
        return `${dayName} at ${formattedTime}`;
    }
}
// Function to fetch and extract data from a StageTEN channel page
async function fetchStageTENChannelData(channelId) {
    try {
        if (!channelId) return null;
        
        // Try to fetch from the StageTEN API
        const response = await fetch(`https://api.stageten.tv/v1/channels/${channelId}`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json'
            }
        });
        
        if (!response.ok) {
            if (response.status === 404) {
                console.log(`Channel ${channelId} not found`);
                return null;
            }
            throw new Error(`API error: ${response.status}`);
        }
        
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching StageTEN channel data:', error);
        return null;
    }
}

// Add StageTEN data to our stream cards
async function enhanceStreamWithStageTENData(stream) {
    if (!stream.watchUrl) return stream;
    
    try {
        // If we already have complete channelData, use it
        if (stream.channelData && stream.channelData.id && stream.channelData.user) {
            return {
                ...stream,
                title: stream.channelData.title || stream.title || stream.shopName,
                description: stream.channelData.description || stream.description || '',
                thumbnailUrl: stream.channelData.splashImageUrl || stream.thumbnailUrl || '',
                avatarUrl: stream.channelData.user?.avatarUrl || stream.avatarUrl || '',
                displayName: stream.channelData.user?.displayName || stream.displayName || stream.shopName,
                socialLinks: stream.channelData.user?.links || []
            };
        }
        
        // Extract channel ID from watchUrl if not already available
        const channelId = stream.channelId || stream.watchUrl.split('/').pop();
        
        if (!channelId) return stream;
        
        // Fetch channel data from API
        const channelData = await fetchStageTENChannelData(channelId);
        
        if (!channelData) {
            // Generate placeholder data if API fails
            return {
                ...stream,
                title: stream.title || `${stream.shopName} - Live Shopping Experience`,
                description: stream.description || 'Join us for exclusive deals and product showcases!',
                thumbnailUrl: stream.thumbnailUrl || `https://picsum.photos/800/400?random=${Math.floor(Math.random() * 1000)}`,
                avatarUrl: stream.avatarUrl,
                displayName: stream.displayName || stream.shopName
            };
        }
        
        // Fetch products if available via Shopify API
        let products = [];
        try {
            if (stream.shopDomain && stream.shopDomain.includes('myshopify.com')) {
                // This would be the place to integrate with Shopify if we had API credentials
                // Since we don't, we'll use placeholder products for now
                products = [
                    {
                        id: `product-${channelId}-1`,
                        title: 'Featured Product 1',
                        price: '$' + (Math.floor(Math.random() * 100) + 20),
                        imageUrl: `https://picsum.photos/200/200?random=${Math.floor(Math.random() * 1000)}`
                    },
                    {
                        id: `product-${channelId}-2`,
                        title: 'Featured Product 2',
                        price: '$' + (Math.floor(Math.random() * 100) + 20),
                        imageUrl: `https://picsum.photos/200/200?random=${Math.floor(Math.random() * 1000) + 1}`
                    },
                    {
                        id: `product-${channelId}-3`,
                        title: 'Featured Product 3',
                        price: '$' + (Math.floor(Math.random() * 100) + 20),
                        imageUrl: `https://picsum.photos/200/200?random=${Math.floor(Math.random() * 1000) + 2}`
                    }
                ];
            }
        } catch (error) {
            console.error('Error fetching Shopify products:', error);
        }
        
        // Return the enhanced stream data
        return {
            ...stream,
            channelData: channelData,
            title: channelData.title || stream.title || stream.shopName,
            description: channelData.description || stream.description || '',
            thumbnailUrl: channelData.splashImageUrl || stream.thumbnailUrl || '',
            avatarUrl: channelData.user?.avatarUrl || stream.avatarUrl || '',
            displayName: channelData.user?.displayName || stream.displayName || stream.shopName,
            socialLinks: channelData.user?.links || [],
            products: products
        };
    } catch (error) {
        console.error('Error enhancing stream with StageTEN data:', error);
        return stream;
    }
}
function createStreamCard(stream, index) {
    // Randomize some data for variety
    const categories = ['Fashion', 'Beauty', 'Luxury', 'Skincare', 'Street Style', 'Makeup'];
    const viewerCounts = ['1.2K', '956', '2.4K', '1.8K', '3.1K', '875'];
    const discounts = ['40% OFF', 'BOGO', 'Free Shipping', '20% OFF', 'Buy 2 Get 1'];
    
    const category = categories[index % categories.length];
    const viewerCount = viewerCounts[index % viewerCounts.length];
    const discount = discounts[index % discounts.length];
    
    // Determine if it's from the user's country
    const isLocalToUser = stream.isLocalToUser || false;
    
    // Use the enhanced data
    const title = stream.title || `${stream.shopName} - Live Shopping Experience`;
    const description = stream.description || '';
    
    // Use good URLs from the API if available
    const thumbnailUrl = stream.thumbnailUrl || `https://picsum.photos/800/400?random=${index}`;
    const avatarUrl = stream.avatarUrl;
    const displayName = stream.displayName || stream.shopName;
    
    // First letter of shop name for avatar fallback
    const avatarInitials = stream.shopName.charAt(0) + (stream.shopName.split(' ')[1] ? stream.shopName.split(' ')[1].charAt(0) : '');
    
    // Generate random location for local creators
    const canadianCities = ['Toronto', 'Vancouver', 'Montreal', 'Calgary', 'Ottawa', 'Edmonton'];
    const location = isLocalToUser ? ` - ${canadianCities[index % canadianCities.length]}` : '';
    
    // Status badge based on stream status
    let statusBadge = '';
    let viewerDisplay = '';
    
    if (stream.streamStatus === 'live') {
        statusBadge = `
        <div class="live-indicator">
            <span class="live-dot"></span>
            LIVE
        </div>`;
        viewerDisplay = `${viewerCount} watching`;
    } else if (stream.streamStatus === 'ended') {
        statusBadge = `
        <div class="live-indicator" style="background: var(--text-muted);">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <path d="M5 3l14 9-14 9V3z"></path>
            </svg>
            REPLAY
        </div>`;
        viewerDisplay = stream.timeAgo;
    } else {
        statusBadge = `
        <div class="live-indicator" style="background: var(--primary);">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="6" x2="12" y2="12"></line>
                <line x1="12" y1="12" x2="16" y2="16"></line>
            </svg>
            SOON
        </div>`;
        viewerDisplay = stream.startTime;
    }
    
    // Product thumbnails with zoom capability
    const productsHtml = stream.products && stream.products.length > 0 ? 
        stream.products.map((product, pIndex) => `
            <div class="product-thumb" data-product-id="${product.id}">
                <img src="${product.imageUrl}" alt="${product.title}" 
                    onclick="showProductZoom('${product.imageUrl}', '${product.title}', '${product.price}')">
                ${isLocalToUser ? `<div class="canadian-product-badge" style="display: block;"></div>` : ''}
            </div>
        `).join('') : 
        `
        <div class="product-thumb">
            <img src="https://picsum.photos/100/100?random=${index * 3 + 1}" alt="Product" 
                onclick="showProductZoom('https://picsum.photos/800/800?random=${index * 3 + 1}', 'Featured Product', '$${Math.floor(Math.random() * 100) + 20}')">
            ${isLocalToUser ? `<div class="canadian-product-badge" style="display: block;"></div>` : ''}
        </div>
        <div class="product-thumb">
            <img src="https://picsum.photos/100/100?random=${index * 3 + 2}" alt="Product"
                onclick="showProductZoom('https://picsum.photos/800/800?random=${index * 3 + 2}', 'Trending Item', '$${Math.floor(Math.random() * 100) + 20}')">
        </div>
        <div class="product-thumb">
            <img src="https://picsum.photos/100/100?random=${index * 3 + 3}" alt="Product"
                onclick="showProductZoom('https://picsum.photos/800/800?random=${index * 3 + 3}', 'New Arrival', '$${Math.floor(Math.random() * 100) + 20}')">
            ${isLocalToUser ? `<div class="canadian-product-badge" style="display: block;"></div>` : ''}
        </div>
        `;
    
    return `
    <div class="stream-card" data-niche="${category.toLowerCase()}" data-local="${isLocalToUser}" onclick="window.open('${stream.watchUrl}', '_blank')" style="cursor: pointer;">
        <div class="stream-thumbnail">
            <img src="${thumbnailUrl}" alt="${stream.shopName}" onerror="this.src='https://picsum.photos/800/400?random=${Math.floor(Math.random() * 100)}'">
            ${statusBadge}
            ${isLocalToUser ? `<div class="canadian-badge" style="display: block;"></div>` : ''}
            <div class="promotion-badge">${stream.streamStatus === 'live' ? discount : (stream.streamStatus === 'ended' ? 'Watch Replay' : stream.timeAgo)}</div>
            <div class="viewer-count">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                ${viewerDisplay}
            </div>
            <div class="products-preview">
                <div class="product-thumbnails">
                    ${productsHtml}
                </div>
            </div>
        </div>
        <div class="stream-details">
            <h3 class="stream-title">${title}</h3>
            ${description ? `<p class="stream-description" style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${description}</p>` : ''}
            <div class="creator-info">
                ${avatarUrl ? 
                    `<div class="creator-avatar" style="background-image: url('${avatarUrl}'); background-size: cover;"></div>` : 
                    `<div class="creator-avatar">${avatarInitials}</div>`
                }
                <span class="creator-name">${displayName}${location}</span>
            </div>
            <div class="stream-footer">
                <span class="category-tag">${category}</span>
                <div class="action-links" style="display:flex; gap:10px;">
                    <a href="${stream.watchUrl}" class="store-link" target="_blank" onclick="event.stopPropagation();">
                        ${stream.streamStatus === 'live' ? 'Watch Live →' : (stream.streamStatus === 'ended' ? 'Watch Replay →' : 'Set Reminder →')}
                    </a>
                    ${stream.shopUrl ? `
                    <a href="${stream.shopUrl}" class="store-link" target="_blank" onclick="event.stopPropagation();" style="color:var(--accent);">
                        Shop →
                    </a>
                    ` : ''}
                </div>
            </div>
        </div>
    </div>
    `;
}
// Generate HTML for creator cards
function createCreatorCard(stream, index) {
    const isLocalToUser = stream.isLocalToUser || false;
                      
    // Use the enhanced data
    const displayName = stream.displayName || stream.shopName;
    const avatarUrl = stream.avatarUrl;
    const avatarInitials = stream.shopName.charAt(0) + (stream.shopName.split(' ')[1] ? stream.shopName.split(' ')[1].charAt(0) : '');
    
    // Generate random stats
    const followers = Math.floor(Math.random() * 500) + 150 + 'K';
    const shows = Math.floor(Math.random() * 100) + 40;
    
    // Generate random categories
    const categories = ['Fashion Influencer', 'Beauty Expert', 'Style Consultant', 'Makeup Artist', 'Wellness Guide'];
    const category = categories[index % categories.length];
    
    // Generate random location for local creators
    const canadianCities = ['Toronto', 'Vancouver', 'Montreal', 'Calgary', 'Ottawa', 'Edmonton'];
    const location = isLocalToUser ? ` - ${canadianCities[index % canadianCities.length]}` : '';
    
    // Generate social links if available
    let socialLinksHtml = '';
    if (stream.socialLinks && stream.socialLinks.length > 0) {
        socialLinksHtml = `
        <div style="display: flex; gap: 8px; margin-top: 8px; justify-content: center;">
            ${stream.socialLinks.map(link => `
                <a href="${link.url}" target="_blank" onclick="event.stopPropagation();" style="color: var(--primary); font-size: 12px;">
                    ${link.title}
                </a>
            `).join('')}
        </div>`;
    }
    
    return `
    <div class="creator-card" data-local="${isLocalToUser}" onclick="window.open('${stream.watchUrl}', '_blank')" style="cursor: pointer;">
        <div class="creator-card-header" style="position: relative;">
            ${avatarUrl ? 
                `<div class="creator-avatar-large" style="background-image: url('${avatarUrl}'); background-size: cover;"></div>` : 
                `<div class="creator-avatar-large" ${index % 2 === 0 && !avatarUrl ? `style="background-image:url('https://picsum.photos/200/200?random=${index}');"` : ''}>${index % 2 !== 0 && !avatarUrl ? avatarInitials : ''}</div>`
            }
            <div class="creator-verified">✓</div>
            ${isLocalToUser ? `<div class="canadian-creator-tag" style="display: block;"></div>` : ''}
        </div>
        <h3 class="creator-name-large">${displayName.split(' ')[0]}</h3>
        <p class="creator-category">${category}${location}</p>
        <div class="creator-stats">
            <div class="creator-stat">
                <span class="creator-stat-value">${followers}</span>
                <span class="creator-stat-label">Followers</span>
            </div>
            <div class="creator-stat">
                <span class="creator-stat-value">${shows}</span>
                <span class="creator-stat-label">Live Shows</span>
            </div>
        </div>
        ${socialLinksHtml}
        <div style="display: flex; gap: 8px; margin-top: 16px;">
            <button class="follow-button" onclick="event.stopPropagation();">Follow</button>
            ${stream.shopUrl ? `
            <a href="${stream.shopUrl}" target="_blank" onclick="event.stopPropagation();" style="flex: 1; text-align: center; padding: 10px; border-radius: 8px; border: 1px solid var(--primary); color: var(--primary); text-decoration: none; font-weight: 600;">Shop</a>
            ` : ''}
        </div>
    </div>
    `;
}

// Clear the existing content and show loading states
function showLoadingState() {
    const containers = [
        document.querySelector('.section:nth-of-type(1) .stream-grid'),
        document.querySelector('.section:nth-of-type(3) .stream-grid'),
        document.querySelector('.creator-grid')
    ];
    
    containers.forEach(container => {
        if (container) {
            container.innerHTML = `
                <div class="stream-card" style="display: flex; align-items: center; justify-content: center; height: 200px; background: var(--background);">
                    <div style="text-align: center;">
                        <div style="width: 40px; height: 40px; border: 3px solid var(--primary); border-top-color: transparent; border-radius: 50%; margin: 0 auto 16px; animation: spin 1s linear infinite;"></div>
                        <p>Loading content...</p>
                    </div>
                </div>
            `;
        }
    });
    
    // Add spin animation if not already present
    if (!document.querySelector('style#loading-animation')) {
        const style = document.createElement('style');
        style.id = 'loading-animation';
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    }
}
// Add after line 1087 (after processStreamData function)
function getCountryInfo(countryCode) {
  const countryMap = {
    "US": { name: "United States", emoji: "🇺🇸", niceName: "American" },
    "CA": { name: "Canada", emoji: "🍁", niceName: "Canadian" },
    "GB": { name: "United Kingdom", emoji: "🇬🇧", niceName: "British" },
    "AU": { name: "Australia", emoji: "🇦🇺", niceName: "Australian" },
    "DE": { name: "Germany", emoji: "🇩🇪", niceName: "German" },
    "FR": { name: "France", emoji: "🇫🇷", niceName: "French" },
    "JP": { name: "Japan", emoji: "🇯🇵", niceName: "Japanese" },
    "KR": { name: "South Korea", emoji: "🇰🇷", niceName: "Korean" },
    "BR": { name: "Brazil", emoji: "🇧🇷", niceName: "Brazilian" },
    "IT": { name: "Italy", emoji: "🇮🇹", niceName: "Italian" },
    "ES": { name: "Spain", emoji: "🇪🇸", niceName: "Spanish" },
    "CN": { name: "China", emoji: "🇨🇳", niceName: "Chinese" },
    "IN": { name: "India", emoji: "🇮🇳", niceName: "Indian" },
    "MX": { name: "Mexico", emoji: "🇲🇽", niceName: "Mexican" },
    "SG": { name: "Singapore", emoji: "🇸🇬", niceName: "Singaporean" },
  };
  
  return countryMap[countryCode] || { name: "Global", emoji: "🌎", niceName: "Local" };
}

const SUPPORTED_COUNTRIES = [
  { code: "US", name: "United States", emoji: "🇺🇸" },
  { code: "CA", name: "Canada", emoji: "🍁" },
  { code: "GB", name: "United Kingdom", emoji: "🇬🇧" },
  { code: "AU", name: "Australia", emoji: "🇦🇺" },
  { code: "DE", name: "Germany", emoji: "🇩🇪" },
  { code: "FR", name: "France", emoji: "🇫🇷" },
  { code: "JP", name: "Japan", emoji: "🇯🇵" },
  { code: "KR", name: "South Korea", emoji: "🇰🇷" },
  { code: "BR", name: "Brazil", emoji: "🇧🇷" },
  { code: "IT", name: "Italy", emoji: "🇮🇹" },
  { code: "ES", name: "Spain", emoji: "🇪🇸" },
  { code: "CN", name: "China", emoji: "🇨🇳" },
  { code: "IN", name: "India", emoji: "🇮🇳" },
  { code: "MX", name: "Mexico", emoji: "🇲🇽" },
  { code: "SG", name: "Singapore", emoji: "🇸🇬" },
  { code: "GLOBAL", name: "Global", emoji: "🌎" }
];

function createCountryDropdown() {
  const existingDropdown = document.getElementById('country-dropdown');
  if (existingDropdown) return;

  // Create dropdown element
  const dropdown = document.createElement('div');
  dropdown.id = 'country-dropdown';
  dropdown.style.position = 'absolute';
  dropdown.style.top = '72px';
  dropdown.style.right = '24px';
  dropdown.style.background = 'var(--surface)';
  dropdown.style.borderRadius = '12px';
  dropdown.style.boxShadow = 'var(--shadow-lg)';
  dropdown.style.padding = '12px';
  dropdown.style.width = '280px';
  dropdown.style.maxHeight = '400px';
  dropdown.style.overflowY = 'auto';
  dropdown.style.zIndex = '200';
  dropdown.style.display = 'none';
  dropdown.style.animation = 'fadeIn 0.2s ease-out';

  // Create header
  const header = document.createElement('div');
  header.style.borderBottom = '1px solid var(--border)';
  header.style.paddingBottom = '8px';
  header.style.marginBottom = '8px';
  header.innerHTML = `
    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 4px;">Select Region</h3>
    <p style="font-size: 12px; color: var(--text-muted);">Choose your location to see local content</p>
  `;
  dropdown.appendChild(header);

  // Add countries to dropdown
  SUPPORTED_COUNTRIES.forEach(country => {
    const countryOption = document.createElement('div');
    countryOption.classList.add('country-option');
    countryOption.dataset.code = country.code;
    countryOption.style.padding = '10px 12px';
    countryOption.style.margin = '4px 0';
    countryOption.style.borderRadius = '8px';
    countryOption.style.cursor = 'pointer';
    countryOption.style.display = 'flex';
    countryOption.style.alignItems = 'center';
    countryOption.style.justifyContent = 'space-between';
    countryOption.style.transition = 'background 0.2s ease';
    
    countryOption.innerHTML = `
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 18px;">${country.emoji}</span>
        <span>${country.name}</span>
      </div>
      <span class="selected-check" style="color: var(--primary); font-weight: bold; display: none;">✓</span>
    `;
    
    countryOption.addEventListener('mouseover', () => {
      countryOption.style.background = 'var(--background)';
    });
    
    countryOption.addEventListener('mouseout', () => {
      countryOption.style.background = '';
    });
    
    countryOption.addEventListener('click', () => {
      selectCountry(country.code);
      toggleDropdown(false);
    });
    
    dropdown.appendChild(countryOption);
  });

  // Add dropdown to DOM
  document.body.appendChild(dropdown);
  
  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    const isDropdown = e.target.closest('#country-dropdown');
    const isRegionBadge = e.target.closest('.region-badge');
    
    if (!isDropdown && !isRegionBadge) {
      toggleDropdown(false);
    }
  });
}


function toggleDropdown(show) {
  const dropdown = document.getElementById('country-dropdown');
  if (!dropdown) return;
  
  if (show === undefined) {
    dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
  } else {
    dropdown.style.display = show ? 'block' : 'none';
  }
  
  // Update selected country visual indicator when opening dropdown
  if (dropdown.style.display === 'block') {
    const currentCountry = localStorage.getItem('selectedCountry') || 'GLOBAL';
    document.querySelectorAll('.country-option').forEach(option => {
      const check = option.querySelector('.selected-check');
      if (option.dataset.code === currentCountry) {
        option.style.background = 'var(--background)';
        check.style.display = 'block';
      } else {
        option.style.background = '';
        check.style.display = 'none';
      }
    });
  }
}
function selectCountry(countryCode) {
  // Store selection in localStorage
  localStorage.setItem('selectedCountry', countryCode);
  
  // Get country info
  const countryInfo = getCountryInfo(countryCode);
  
  // Update UI
  updateCountrySpecificUI(countryCode, countryInfo);
  
  // Update region badge immediately
  const regionBadge = document.querySelector('.region-badge');
  if (regionBadge) {
    const regionSpan = regionBadge.querySelector('span:nth-child(1)');
    const regionText = regionBadge.querySelector('span:nth-child(2)');
    
    if (regionSpan) regionSpan.textContent = countryInfo.emoji;
    if (regionText) regionText.textContent = countryInfo.name;
  }
  
  // Refresh stream data with new country
  populateStreamData(countryCode);
}

async function fetchStreamData() {
    try {
        // Use our new Cloudflare worker endpoint that provides enhanced data
        const response = await fetch('https://young-grass-8d02.vdo.workers.dev/');
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const data = await response.json();
        
        // Check if the API returns country information
        const countryData = data.find(item => item.country);
        
        // Store detected country in localStorage if available
        if (countryData && countryData.country && !localStorage.getItem('userDetectedCountry')) {
            localStorage.setItem('userDetectedCountry', countryData.country);
        }
        
        return data;
    } catch (error) {
        console.error('Error fetching data:', error);
        return null;
    }
}
document.querySelector('.region-badge').addEventListener('click', function(e) {
  e.stopPropagation();
  toggleDropdown();
});

document.addEventListener('DOMContentLoaded', function() {
  // Create country dropdown
  createCountryDropdown();
  
  // Add click event for region badge if not already set
  const regionBadge = document.querySelector('.region-badge');
  if (regionBadge) {
    // Remove existing event listeners to prevent duplicates
    const newRegionBadge = regionBadge.cloneNode(true);
    regionBadge.parentNode.replaceChild(newRegionBadge, regionBadge);
    
    // Add the click event
    newRegionBadge.addEventListener('click', function(e) {
      e.stopPropagation();
      toggleDropdown();
    });
  }

    // Clear hardcoded stream cards
    const streamGrids = document.querySelectorAll('.stream-grid');
    streamGrids.forEach(grid => {
        grid.innerHTML = '';
    });
    
    // Fix for the hero banner image
    const heroVisual = document.querySelector('.hero-visual');
    if (heroVisual) {
        heroVisual.style.backgroundImage = "url('https://picsum.photos/800/400?random=hero')";
    }
    
    // Replace placeholder images
    document.querySelectorAll('img[src^="/api/placeholder"]').forEach(img => {
        const alt = img.alt || 'placeholder';
        const size = img.src.match(/\/(\d+)\/(\d+)$/);
        let width = 400, height = 300;
        
        if (size && size.length >= 3) {
            width = size[1];
            height = size[2];
        }
        
        img.src = `https://picsum.photos/${width}/${height}?random=${Math.floor(Math.random() * 1000)}`;
        img.setAttribute('data-original-src', img.src);
    });
    
    // Get initial country to display
    // Priority: 1. User-selected country, 2. Detected country, 3. Default (GLOBAL)
    const userSelectedCountry = localStorage.getItem('selectedCountry');
    const detectedCountry = localStorage.getItem('userDetectedCountry');
    const initialCountry = userSelectedCountry || detectedCountry || 'GLOBAL';
    
    // Update region badge with country info
    const countryInfo = getCountryInfo(initialCountry);
    updateRegionBadge(countryInfo);
    
    // Fetch and display streams
    populateStreamData(initialCountry);
    addProductZoomModal();
});

// Helper function to update region badge
function updateRegionBadge(countryInfo) {
    const regionBadge = document.querySelector('.region-badge');
    if (regionBadge && countryInfo) {
        const regionSpan = regionBadge.querySelector('span:nth-child(1)');
        const regionText = regionBadge.querySelector('span:nth-child(2)');
        
        if (regionSpan) regionSpan.textContent = countryInfo.emoji;
        if (regionText) regionText.textContent = countryInfo.name;
    }
}

// Update populateStreamData function to handle country detection
function populateStreamData(countryCode) {
    // Show loading state
    showLoadingState();
    
    // Try to get data from primary source
    fetchStreamData().then(streams => {
        // Get country in order of priority: specified > user selected > detected > default
        let userCountry = countryCode || 
                          localStorage.getItem('selectedCountry') || 
                          localStorage.getItem('userDetectedCountry') || 
                          "GLOBAL";
        
        // If it's the first page load and we got a country from the API
        // and the user hasn't already selected a country, use the detected country
        if (!countryCode && !localStorage.getItem('selectedCountry') && streams && 
            streams.find(s => s.country) && streams.find(s => s.country).country) {
            userCountry = streams.find(s => s.country).country;
            localStorage.setItem('userDetectedCountry', userCountry);
        }
        
        // If not a valid country code, default to GLOBAL
        if (!SUPPORTED_COUNTRIES.find(c => c.code === userCountry)) {
            userCountry = "GLOBAL";
        }
        
        // If we're auto-selecting the user's country based on detection,
        // save that as their selected country for consistency
        if (!localStorage.getItem('selectedCountry') && userCountry !== 'GLOBAL') {
            localStorage.setItem('selectedCountry', userCountry);
        }
        
        // Get country information from the code
        const countryInfo = getCountryInfo(userCountry);
        console.log(`User country: ${userCountry} (${countryInfo.name})`);
        
        // Update UI elements based on country
        updateCountrySpecificUI(userCountry, countryInfo);
        
        // Update the region badge to show current selection
        updateRegionBadge(countryInfo);
        
        // Update selected indicator in dropdown
        updateDropdownSelection(userCountry);
        
        // If no data available from primary source, use fallback
        if (!streams) {
            console.log('No data from primary API, using fallback data');
            streams = getFallbackData();
        }
        
        // Process streams and continue with existing code...
        streams = processStreamData(streams);
        console.log(`Processed ${streams.length} streams`);
        
        // Rest of function remains the same...
        // Mark streams from the same country as the user
        streams = streams.map(stream => {
            // Determine if stream is from user's country
            const isFromUserCountry = determineStreamCountry(stream, userCountry);
            return { ...stream, isLocalToUser: isFromUserCountry };
        });
        
        // Sort streams - local ones first, then by status
        streams.sort((a, b) => {
            // First prioritize by local vs non-local
            if (a.isLocalToUser !== b.isLocalToUser) {
                return a.isLocalToUser ? -1 : 1;
            }
            
            // Then sort by status
            const statusOrder = { live: 0, upcoming: 1, ended: 2 };
            if (statusOrder[a.streamStatus] !== statusOrder[b.streamStatus]) {
                return statusOrder[a.streamStatus] - statusOrder[b.streamStatus];
            }
            
            // Finally sort by timestamp
            if (a.streamStatus === 'ended') {
                return b.timestamp - a.timestamp; // Older ended streams first
            } else {
                return b.timestamp - a.timestamp; // Newer live/upcoming streams first
            }
        });
        
        // Continue with updating the UI...
        // Existing code for populating containers...
        
        // Get the containers
        const liveStreamContainer = document.querySelector('.section:nth-of-type(1) .stream-grid');
        const upcomingStreamContainer = document.querySelector('.section:nth-of-type(3) .stream-grid');
        const creatorContainer = document.querySelector('.creator-grid');
        
        // Group streams by status
        const liveStreams = streams.filter(stream => stream.streamStatus === 'live');
        const upcomingStreams = streams.filter(stream => stream.streamStatus === 'upcoming');
        const endedStreams = streams.filter(stream => stream.streamStatus === 'ended');
        
        console.log(`Live: ${liveStreams.length}, Upcoming: ${upcomingStreams.length}, Ended: ${endedStreams.length}`);
        
        // Populate containers as before...
        // Populate the "Live Now" section
        if (liveStreamContainer) {
            liveStreamContainer.innerHTML = ''; // Clear existing content
            
            // Create a combined array of all streams for display, prioritizing live ones
            let displayStreams = [];
            
            // First add all live streams
            displayStreams = displayStreams.concat(liveStreams);
            
            // Then add upcoming streams
            displayStreams = displayStreams.concat(upcomingStreams);
            
            // Then add ended streams until we have at least 4 (or all if less than 4)
            const neededEndedStreams = Math.max(0, 4 - displayStreams.length);
            displayStreams = displayStreams.concat(endedStreams.slice(0, neededEndedStreams));
            
            // If we still don't have enough, use all remaining streams
            if (displayStreams.length < 4 && displayStreams.length < streams.length) {
                const remainingStreams = streams.filter(s => 
                    !displayStreams.some(ds => ds.shopName === s.shopName && ds.watchUrl === s.watchUrl));
                displayStreams = displayStreams.concat(remainingStreams);
            }
            
            // Display streams in the grid (up to a reasonable maximum)
            const maxToDisplay = Math.min(displayStreams.length, 8);
            console.log(`Displaying ${maxToDisplay} streams in the "Live Now" section`);
            
            for (let i = 0; i < maxToDisplay; i++) {
                liveStreamContainer.innerHTML += createStreamCard(displayStreams[i], i);
            }
        }
        
        // Populate the "Starting Soon" section
        if (upcomingStreamContainer) {
            upcomingStreamContainer.innerHTML = ''; // Clear existing content
            
            // If we have upcoming streams, show them first
            if (upcomingStreams.length > 0) {
                upcomingStreams.forEach((stream, index) => {
                    upcomingStreamContainer.innerHTML += createStreamCard(stream, index);
                });
            } 
            // Otherwise, show some ended streams
            else {
                const displayCount = Math.min(endedStreams.length, 2);
                for (let i = 0; i < displayCount; i++) {
                    upcomingStreamContainer.innerHTML += createStreamCard(endedStreams[i], i);
                }
            }
        }
        
        // Populate the creator section
		if (creatorContainer) {
			creatorContainer.innerHTML = ''; // Clear existing content
			
			// Remove duplicates by shopName
			const uniqueCreators = [];
			const seenShopNames = {};
			
			streams.forEach(stream => {
				if (!seenShopNames[stream.shopName]) {
					seenShopNames[stream.shopName] = true;
					uniqueCreators.push(stream);
				}
			});
			
			// Use unique creators
			uniqueCreators.forEach((stream, index) => {
				creatorContainer.innerHTML += createCreatorCard(stream, index);
			});
		}
        
        // Reinitialize event listeners for the newly created elements
        initializeEventListeners();
        
        // Now try to enhance the data with additional details
        enhanceStreamDetails(streams);
    });
}
function updateDropdownSelection(countryCode) {
    const dropdown = document.getElementById('country-dropdown');
    if (!dropdown) return;
    
    document.querySelectorAll('.country-option').forEach(option => {
        const check = option.querySelector('.selected-check');
        if (option.dataset.code === countryCode) {
            option.style.background = 'var(--background)';
            check.style.display = 'block';
        } else {
            option.style.background = '';
            check.style.display = 'none';
        }
    });
}

function determineStreamCountry(stream, userCountry) {
    // Logic to determine if stream is from user's country
    const isFromCanada = (
        stream.isCanadian || 
        (stream.shopDomain && stream.shopDomain.includes('.ca')) ||
        (stream.shopName && stream.shopName.toLowerCase().includes('canadian')) ||
        (stream.email && stream.email.toLowerCase().includes('.ca'))
    );
    
    // For Canada, specifically check Canadian identifiers
    if (userCountry === "CA" && isFromCanada) {
        return true;
    }
    
    // For other countries, check domain extensions or keywords in shop name/email
    const countryDomains = {
        "US": [".us", ".com"],
        "GB": [".uk", ".co.uk"],
        "AU": [".au", ".com.au"],
        "DE": [".de"],
        "FR": [".fr"],
        "JP": [".jp"],
        "KR": [".kr"],
        "BR": [".br", ".com.br"],
        "IT": [".it"],
        "ES": [".es"],
        "CN": [".cn"],
        "IN": [".in"],
        "MX": [".mx"],
        "SG": [".sg"]
    };
    
    // Check country-specific keywords in shop name
    const countryKeywords = {
        "US": ["america", "usa", "states"],
        "GB": ["uk", "britain", "british", "england"],
        "AU": ["australia", "aussie"],
        "DE": ["german", "deutschland"],
        "FR": ["france", "french"],
        "JP": ["japan", "japanese"],
        "KR": ["korea", "korean"],
        "BR": ["brazil", "brazilian"],
        "IT": ["italy", "italian"],
        "ES": ["spain", "spanish"],
        "IN": ["india", "indian"],
        "MX": ["mexico", "mexican"],
        "SG": ["singapore", "singaporean"]
    };
    
    // Check domain extensions
    if (stream.shopDomain && countryDomains[userCountry]) {
        for (const domain of countryDomains[userCountry]) {
            if (stream.shopDomain.toLowerCase().endsWith(domain)) {
                return true;
            }
        }
    }
    
    // Check country keywords in shop name or email
    if (countryKeywords[userCountry]) {
        const shopNameLower = (stream.shopName || "").toLowerCase();
        const emailLower = (stream.email || "").toLowerCase();
        
        for (const keyword of countryKeywords[userCountry]) {
            if (shopNameLower.includes(keyword) || emailLower.includes(keyword)) {
                return true;
            }
        }
    }
    
    // Check any explicit country field that might be available
    if (stream.country === userCountry) {
        return true;
    }
    
    // Default to false if no matches
    return false;
}

// Function to update UI elements based on country
function updateCountrySpecificUI(userCountry, countryInfo) {
    // Update the region badge in the header
    const regionBadge = document.querySelector('.region-badge');
    if (regionBadge) {
        const regionSpan = regionBadge.querySelector('span:nth-child(1)');
        const regionText = regionBadge.querySelector('span:nth-child(2)');
        
        if (regionSpan) regionSpan.textContent = countryInfo.emoji;
        if (regionText) regionText.textContent = countryInfo.name;
    }
    
    // Show/hide the Canadian shipping banner based on country
    const shippingBanner = document.querySelector('.free-shipping-banner');
    if (shippingBanner) {
        if (userCountry === "CA") {
            shippingBanner.style.display = 'flex';
            // Update the text to be more specific
            shippingBanner.innerHTML = `
                <span>${countryInfo.emoji} BUY ${countryInfo.niceName.toUpperCase()}-MADE, GET FREE SHIPPING!</span>
                <span style="font-weight: 400;">StageTEN covers shipping for all locally made products</span>
            `;
        } else {
            shippingBanner.style.display = 'none';
        }
    }
    
    // Update "Canadian Made" badges to be country-specific
    document.querySelectorAll('.canadian-badge').forEach(badge => {
        badge.className = 'canadian-badge';
        badge.classList.add(`${countryInfo.niceName.toLowerCase()}-badge`);
        badge.textContent = `${countryInfo.niceName} Made`;
        badge.style.display = 'none'; // Hide by default, will show for matching country streams
    });
    
    // Update "Canadian Creator" tags
    document.querySelectorAll('.canadian-creator-tag').forEach(tag => {
        tag.className = 'canadian-creator-tag';
        tag.classList.add(`${countryInfo.niceName.toLowerCase()}-creator-tag`);
        tag.textContent = `${countryInfo.niceName} Creator`;
        tag.style.display = 'none'; // Hide by default, will show for matching country creators
    });
    
    // Update product badges
    document.querySelectorAll('.canadian-product-badge').forEach(badge => {
        badge.className = 'canadian-product-badge';
        badge.classList.add(`${countryInfo.niceName.toLowerCase()}-product-badge`);
        badge.innerHTML = countryInfo.emoji;
        badge.style.display = 'none'; // Hide by default
    });
    
    // Add country-specific styles
    addCountrySpecificStyles(userCountry, countryInfo);
}

// Add custom styles for each country
function addCountrySpecificStyles(userCountry, countryInfo) {
    // Remove any existing country styles
    const existingStyles = document.getElementById('country-specific-styles');
    if (existingStyles) existingStyles.remove();
    
    // Define country-specific colors
    const countryColors = {
        "US": { primary: "#3C3B6E", secondary: "#B22234" },
        "CA": { primary: "#D64045", secondary: "#B03236" },
        "GB": { primary: "#012169", secondary: "#C8102E" },
        "AU": { primary: "#00008B", secondary: "#FF0000" },
        "DE": { primary: "#000000", secondary: "#DD0000" },
        "FR": { primary: "#0055A4", secondary: "#EF4135" },
        "JP": { primary: "#BC002D", secondary: "#000000" },
        "KR": { primary: "#003478", secondary: "#C60C30" },
        "BR": { primary: "#009C3B", secondary: "#FFDF00" },
        "IT": { primary: "#008C45", secondary: "#CD212A" },
        "ES": { primary: "#AA151B", secondary: "#F1BF00" },
        "CN": { primary: "#DE2910", secondary: "#FFDE00" },
        "IN": { primary: "#FF9933", secondary: "#138808" },
        "MX": { primary: "#006847", secondary: "#CE1126" },
        "SG": { primary: "#ED2939", secondary: "#FFFFFF" },
        "default": { primary: "#6B46C1", secondary: "#ED64A6" }
    };
    
    // Get colors for this country or use default
    const colors = countryColors[userCountry] || countryColors.default;
    
    // Create new style element
    const styleEl = document.createElement('style');
    styleEl.id = 'country-specific-styles';
    
    // Add country-specific badge styles
    styleEl.textContent = `
        .${countryInfo.niceName.toLowerCase()}-badge {
            position: absolute;
            top: 12px;
            left: 72px; /* Positioned next to LIVE badge */
            background: ${colors.primary};
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .${countryInfo.niceName.toLowerCase()}-badge::before {
            content: '${countryInfo.emoji}';
        }
        
        .${countryInfo.niceName.toLowerCase()}-creator-tag {
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: ${colors.primary};
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .${countryInfo.niceName.toLowerCase()}-creator-tag::before {
            content: '${countryInfo.emoji}';
            font-size: 10px;
        }
        
        .${countryInfo.niceName.toLowerCase()}-product-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(${hexToRgb(colors.primary)}, 0.9);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .free-shipping-banner {
            background: linear-gradient(135deg, ${colors.primary} 0%, ${colors.secondary} 100%);
        }
        
        /* Highlight streams from this country */
        .stream-card[data-local="true"] {
            border: 2px solid ${colors.primary};
            box-shadow: 0 0 15px rgba(${hexToRgb(colors.primary)}, 0.3);
        }
    `;
    
    // Add the styles to the page
    document.head.appendChild(styleEl);
}

// Helper function to convert hex to RGB
function hexToRgb(hex) {
    // Remove the # if present
    hex = hex.replace('#', '');
    
    // Parse the hex values
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);
    
    return `${r}, ${g}, ${b}`;
}
function addProductZoomModal() {
    // Add the modal HTML to the page
    const modalHtml = `
    <div id="product-zoom-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: none; justify-content: center; align-items: center;">
        <div style="position: relative; max-width: 90%; max-height: 90%; background: white; border-radius: 12px; overflow: hidden; box-shadow: var(--shadow-lg);">
            <button onclick="closeProductZoom()" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.5); color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; z-index: 10;">×</button>
            <div style="display: flex; flex-direction: column; height: 100%;">
                <div id="zoom-image-container" style="flex: 1; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden;">
                    <img id="zoom-image" src="" alt="Product" style="max-width: 100%; max-height: 70vh; object-fit: contain; transition: transform 0.3s ease;">
                </div>
                <div style="padding: 16px; background: white;">
                    <h3 id="zoom-title" style="font-size: 18px; margin-bottom: 8px;"></h3>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span id="zoom-price" style="font-size: 24px; font-weight: 600; color: var(--primary);"></span>
                        <button style="background: var(--gradient-primary); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer;">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    `;
    
    // Add the modal to the page
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Add the zoom functionality
    const zoomContainer = document.getElementById('zoom-image-container');
    const zoomImage = document.getElementById('zoom-image');
    
    if (zoomContainer && zoomImage) {
        let isZoomed = false;
        let startX = 0, startY = 0;
        let translateX = 0, translateY = 0;
        
        zoomContainer.addEventListener('click', function(e) {
            if (e.target === zoomImage) {
                if (!isZoomed) {
                    zoomImage.style.transform = 'scale(2)';
                    isZoomed = true;
                } else {
                    zoomImage.style.transform = 'scale(1)';
                    zoomImage.style.transformOrigin = 'center';
                    isZoomed = false;
                    translateX = 0;
                    translateY = 0;
                }
            }
        });
        
        zoomContainer.addEventListener('mousemove', function(e) {
            if (isZoomed) {
                const rect = zoomContainer.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                zoomImage.style.transformOrigin = `${x}% ${y}%`;
            }
        });
        
        // Add touch support for mobile
        zoomContainer.addEventListener('touchstart', function(e) {
            if (isZoomed) {
                const touch = e.touches[0];
                startX = touch.clientX - translateX;
                startY = touch.clientY - translateY;
                e.preventDefault();
            }
        });
        
        zoomContainer.addEventListener('touchmove', function(e) {
            if (isZoomed) {
                const touch = e.touches[0];
                translateX = touch.clientX - startX;
                translateY = touch.clientY - startY;
                zoomImage.style.transform = `scale(2) translate(${translateX / 2}px, ${translateY / 2}px)`;
                e.preventDefault();
            }
        });
    }
    
    // Add the global functions
    window.showProductZoom = function(imageUrl, title, price) {
        const modal = document.getElementById('product-zoom-modal');
        const zoomImage = document.getElementById('zoom-image');
        const zoomTitle = document.getElementById('zoom-title');
        const zoomPrice = document.getElementById('zoom-price');
        
        if (modal && zoomImage && zoomTitle && zoomPrice) {
            zoomImage.src = imageUrl;
            zoomTitle.textContent = title;
            zoomPrice.textContent = price;
            
            // Reset zoom state
            zoomImage.style.transform = 'scale(1)';
            zoomImage.style.transformOrigin = 'center';
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent scrolling
            
            // Stop propagation
            event.stopPropagation();
        }
    };
    
    window.closeProductZoom = function() {
        const modal = document.getElementById('product-zoom-modal');
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = ''; // Restore scrolling
        }
    };
    
    // Close modal when clicking outside the image
    document.getElementById('product-zoom-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeProductZoom();
        }
    });
}

document.addEventListener('DOMContentLoaded', function() {
    // Create country dropdown
    createCountryDropdown();

    // Clear hardcoded stream cards
    const streamGrids = document.querySelectorAll('.stream-grid');
    streamGrids.forEach(grid => {
        grid.innerHTML = '';
    });
    
    // Fix for the hero banner image
    const heroVisual = document.querySelector('.hero-visual');
    if (heroVisual) {
        heroVisual.style.backgroundImage = "url('https://picsum.photos/800/400?random=hero')";
    }
    
    // Replace placeholder images
    document.querySelectorAll('img[src^="/api/placeholder"]').forEach(img => {
        const alt = img.alt || 'placeholder';
        const size = img.src.match(/\/(\d+)\/(\d+)$/);
        let width = 400, height = 300;
        
        if (size && size.length >= 3) {
            width = size[1];
            height = size[2];
        }
        
        img.src = `https://picsum.photos/${width}/${height}?random=${Math.floor(Math.random() * 1000)}`;
        img.setAttribute('data-original-src', img.src);
    });
    
    // Get initial country to display
    // Priority: 1. User-selected country, 2. Detected country, 3. Default (GLOBAL)
    const userSelectedCountry = localStorage.getItem('selectedCountry');
    const detectedCountry = localStorage.getItem('userDetectedCountry');
    const initialCountry = userSelectedCountry || detectedCountry || 'GLOBAL';
    
    // Update region badge with country info
    const countryInfo = getCountryInfo(initialCountry);
    updateRegionBadge(countryInfo);
    
    // Fetch and display streams
    populateStreamData(initialCountry);
    addProductZoomModal();
});
function updateRegionBadge(countryInfo) {
    const regionBadge = document.querySelector('.region-badge');
    if (regionBadge && countryInfo) {
        const regionSpan = regionBadge.querySelector('span:nth-child(1)');
        const regionText = regionBadge.querySelector('span:nth-child(2)');
        
        if (regionSpan) regionSpan.textContent = countryInfo.emoji;
        if (regionText) regionText.textContent = countryInfo.name;
    }
}
// Enhance stream details with additional data from StageTEN
async function enhanceStreamDetails(streams) {
    // We'll process the streams in parallel for efficiency
	
    const enhancementPromises = streams.map(enhanceStreamWithStageTENData);
    
    try {
        const enhancedStreams = await Promise.all(enhancementPromises);
        
        // Now that we have enhanced data, update the UI
        updateStreamUI(enhancedStreams);
    } catch (error) {
        console.error('Error enhancing stream details:', error);
    }
}

// Update the UI with enhanced stream data
function updateStreamUI(enhancedStreams) {
    // Update live streams section
    const liveStreams = enhancedStreams.slice(0, 4);
    liveStreams.forEach((stream, index) => {
        // Find the corresponding card
        const card = document.querySelector(`.section:nth-of-type(1) .stream-grid .stream-card:nth-child(${index + 1})`);
        if (card) {
            // Update image if available
            if (stream.thumbnailUrl) {
                const img = card.querySelector('.stream-thumbnail img');
                if (img) img.src = stream.thumbnailUrl;
            }
            
            // Update title if available
            if (stream.title) {
                const title = card.querySelector('.stream-title');
                if (title) title.textContent = stream.title;
            }
            
            // Update avatar if available
            if (stream.avatarUrl) {
                const avatar = card.querySelector('.creator-avatar');
                if (avatar) {
                    avatar.style.backgroundImage = `url('${stream.avatarUrl}')`;
                    avatar.style.backgroundSize = 'cover';
                    avatar.textContent = '';
                }
            }
            
            // Update creator name if available
            if (stream.displayName) {
                const name = card.querySelector('.creator-name');
                if (name) {
                    // Keep location if it exists
                    const location = name.textContent.includes(' - ') ? 
                        name.textContent.substring(name.textContent.indexOf(' - ')) : '';
                    name.textContent = stream.displayName + location;
                }
            }
            
            // Add description if available
            if (stream.description && !card.querySelector('.stream-description')) {
                const detailsSection = card.querySelector('.stream-details');
                const title = detailsSection.querySelector('.stream-title');
                if (detailsSection && title) {
                    const description = document.createElement('p');
                    description.className = 'stream-description';
                    description.style.fontSize = '12px';
                    description.style.color = 'var(--text-muted)';
                    description.style.marginBottom = '8px';
                    description.style.display = '-webkit-box';
                    description.style.webkitLineClamp = '2';
                    description.style.webkitBoxOrient = 'vertical';
                    description.style.overflow = 'hidden';
                    description.textContent = stream.description;
                    detailsSection.insertBefore(description, title.nextSibling);
                }
            }
        }
    });
    
    // Update upcoming streams section similarly
    const upcomingStreams = enhancedStreams.slice(0, 2);
    upcomingStreams.forEach((stream, index) => {
        const card = document.querySelector(`.section:nth-of-type(3) .stream-grid .stream-card:nth-child(${index + 1})`);
        if (card) {
            // Similar updates as above
            if (stream.thumbnailUrl) {
                const img = card.querySelector('.stream-thumbnail img');
                if (img) img.src = stream.thumbnailUrl;
            }
            
            if (stream.title) {
                const title = card.querySelector('.stream-title');
                if (title) title.textContent = stream.title;
            }
            
            if (stream.avatarUrl) {
                const avatar = card.querySelector('.creator-avatar');
                if (avatar) {
                    avatar.style.backgroundImage = `url('${stream.avatarUrl}')`;
                    avatar.style.backgroundSize = 'cover';
                    avatar.textContent = '';
                }
            }
            
            if (stream.displayName) {
                const name = card.querySelector('.creator-name');
                if (name) {
                    const location = name.textContent.includes(' - ') ? 
                        name.textContent.substring(name.textContent.indexOf(' - ')) : '';
                    name.textContent = stream.displayName + location;
                }
            }
            
            if (stream.description && !card.querySelector('.stream-description')) {
                const detailsSection = card.querySelector('.stream-details');
                const title = detailsSection.querySelector('.stream-title');
                if (detailsSection && title) {
                    const description = document.createElement('p');
                    description.className = 'stream-description';
                    description.style.fontSize = '12px';
                    description.style.color = 'var(--text-muted)';
                    description.style.marginBottom = '8px';
                    description.style.display = '-webkit-box';
                    description.style.webkitLineClamp = '2';
                    description.style.webkitBoxOrient = 'vertical';
                    description.style.overflow = 'hidden';
                    description.textContent = stream.description;
                    detailsSection.insertBefore(description, title.nextSibling);
                }
            }
        }
    });
    
    // Update creator cards
    enhancedStreams.forEach((stream, index) => {
        const card = document.querySelector(`.creator-grid .creator-card:nth-child(${index + 1})`);
        if (card) {
            if (stream.avatarUrl) {
                const avatar = card.querySelector('.creator-avatar-large');
                if (avatar) {
                    avatar.style.backgroundImage = `url('${stream.avatarUrl}')`;
                    avatar.style.backgroundSize = 'cover';
                    avatar.textContent = '';
                }
            }
            
            if (stream.displayName) {
                const name = card.querySelector('.creator-name-large');
                if (name) name.textContent = stream.displayName.split(' ')[0];
            }
        }
    });
}

// Initialize event listeners for interactive elements
function initializeEventListeners() {
  // Niche filtering
  const nicheButtons = document.querySelectorAll('.niche-btn');
  const streamCards = document.querySelectorAll('.stream-card');

  nicheButtons.forEach(button => {
    button.addEventListener('click', () => {
      nicheButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      
      const selectedNiche = button.dataset.niche;
      
      streamCards.forEach(card => {
        if (selectedNiche === 'all' || card.dataset.niche === selectedNiche) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });

  // Follow button interaction
  const followButtons = document.querySelectorAll('.follow-button');
  followButtons.forEach(button => {
    button.addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent clicking through to parent element
      if (button.textContent === 'Follow') {
        button.textContent = 'Following';
        button.style.background = 'var(--success)';
      } else {
        button.textContent = 'Follow';
        button.style.background = '';
      }
    });
  });

  // Region selector dropdown toggle
  const regionBadge = document.querySelector('.region-badge');
  if (regionBadge) {
    regionBadge.addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent closing immediately
      toggleDropdown();
    });
  }
  
  // Add hover effects to cards to indicate they're clickable
  const allCards = document.querySelectorAll('.stream-card, .creator-card');
  allCards.forEach(card => {
    card.addEventListener('mouseenter', () => {
      card.style.transform = 'translateY(-5px)';
      card.style.boxShadow = 'var(--shadow-lg)';
      card.style.borderColor = 'var(--primary-light)';
    });
    
    card.addEventListener('mouseleave', () => {
      card.style.transform = '';
      card.style.boxShadow = '';
      card.style.borderColor = '';
    });
  });
}


</script>
</body>
</html>
